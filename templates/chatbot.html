<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MindCare Chatbot</title>
  <link rel="stylesheet" href="../static/style (chatbot).css">
</head>
<body>

  <header>
    <div class="logo"><b>MindCare</b></div>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="Sign in.html">Log in / Sign up</a></li>
        <li><a href="#">Contact Us</a></li>
      </ul>
    </nav>
  </header>

   
  <div class="chat-container">
    <div class="chat-messages" id="chatMessages">
      <div class="bot-message message">
      Helloü§ñ! I‚Äôm your AI Driven Mental Health Companion. How can I help you?üòä
      </div>
    </div>
    <div class="chat-input">
      <input type="text" id="userInput" placeholder="Type your message..." />
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>

 <script>
    document.getElementById("userInput").addEventListener("keydown", function (event) {
      if (event.key === "Enter") {
        event.preventDefault();  // avoid new line
        sendMessage();           // trigger message send
      }
    });

    // ‚úÖ Your chatbot logic
    async function sendMessage() {
      const input = document.getElementById("userInput");
      const message = input.value.trim();
      if (!message) return;

      const messagesDiv = document.getElementById("chatMessages");

      // show user message
      const userMsgDiv = document.createElement("div");
      userMsgDiv.className = "user-message message";
      userMsgDiv.textContent = message;
      messagesDiv.appendChild(userMsgDiv);
      input.value = "";

      messagesDiv.scrollTop = messagesDiv.scrollHeight;

      try {
          const res = await fetch("http://127.0.0.1:5000/ask", {
               method: "POST",
               headers: {"Content-Type": "application/json"},
               body: JSON.stringify({ question: message })
          });

        const data = await res.json();

        // show bot message
        const botMsgDiv = document.createElement("div");
        botMsgDiv.className = "bot-message message";
        // clean & format the chatbot's text
        const formattedAnswer = (data.answer || "Sorry, I couldn‚Äôt process that.")
          .replace(/\*\*/g, "")   // remove bold markers **
          .replace(/\*/g, "")     // remove italic markers *
          .replace(/\n/g, "<br>"); // convert newlines to line breaks

        botMsgDiv.innerHTML = formattedAnswer; // use innerHTML so <br> works
        messagesDiv.appendChild(botMsgDiv);


        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      } catch (err) {
        const errorDiv = document.createElement("div");
        errorDiv.className = "bot-message message";
        errorDiv.textContent = "‚ö†Ô∏è Error connecting to chatbot.";
        messagesDiv.appendChild(errorDiv);
      }
    }
  </script>

  <footer>
        <br>
        <p>¬© 2025 MindCare. All rights reserved.</p>
    </footer>

</body>
</html>
